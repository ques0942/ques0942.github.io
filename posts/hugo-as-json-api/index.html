<!doctype html><html lang=en-us data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>Hugo as JSON API - 常にいまいち</title><meta name=description content="blog for something"><link rel=icon type=image/x-icon href=https://blog.app.melvins-nest.com/favicon.ico><link rel=apple-touch-icon-precomposed href=https://blog.app.melvins-nest.com/favicon.png><link rel=stylesheet href="https://blog.app.melvins-nest.com/css/light.css?rnd=1621001651"><style>[data-theme=dark]{--font-color: #eee;--bg-color: #212121;--link-color:#599ada;--link-state-color:#ff5858;--link-state-border-color: rgba(238, 54, 54, 0.5);--thead-bg-color: #343a40;--table-border-color: lightgrey;--pre-color: #333;--pre-bg-color: #f1f1f1;--bq-color: #ccc;--hr-color: #333;--pagination-bg-color: #373737;--pagination-link-color: #b6b6b6;--post-info-color: grey;--switcher-color: #333;--switcher-bg-color: #fff}</style><link rel=stylesheet href="https://blog.app.melvins-nest.com/css/style.css?rnd=1621001651"><meta property="og:title" content="Hugo as JSON API"><meta property="og:description" content="やりたいこと Hugoでブログを始めたものの、JSONでコンテンツをみることができると嬉しいので方法を調べてみた。
ビルドに使用しているのはMac上のHugo(Hugo Static Site Generator v0.62.0/extended darwin/amd64)
参考URL https://forestry.io/blog/build-a-json-api-with-hugo/
やったこと config.tomlにoutput formatを追加 以下の内容を追加。HTMLのページ自体はそのまま残したいのでHTMLとJSONを指定する。
[outputs] home = [&#34;HTML&#34;, &#34;JSON&#34;] section = [&#34;HTML&#34;, &#34;JSON&#34;] page = [&#34;HTML&#34;, &#34;JSON&#34;] テンプレートを作成 layouts/_default 配下に以下のファイルを作成する。
ファイル名は {pageKind}.{outputFormatName}.{extension} という形式になる。今回は outputFormatName=json、 extension=jsonとなるので、JSON形式の出力の共通部分を記述した baseof、リスト表示用の list、単体表示用の single、それらの中で表示する1要素を表すための itemの4つを作成する。
 baseof.json.json item.json.json single.json.json list.json.json  layouts/_default/baseof.json.json { &#34;data&#34; : {{ block &#34;response&#34; .}}{{ end }} } このブログのJSONレスポンスは全てdata プロパティとして response ブロックをレンダリングして返す。 各 pageKindでは responseを定義する。
layouts/_default/item.json.json { &#34;title&#34;: &#34;{{ .Title }}&#34;, &#34;date&#34;: &#34;{{ ."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.app.melvins-nest.com/posts/hugo-as-json-api/"><meta property="article:published_time" content="2020-01-01T23:11:43+09:00"><meta property="article:modified_time" content="2020-01-01T23:11:43+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Hugo as JSON API"><meta name=twitter:description content="やりたいこと Hugoでブログを始めたものの、JSONでコンテンツをみることができると嬉しいので方法を調べてみた。
ビルドに使用しているのはMac上のHugo(Hugo Static Site Generator v0.62.0/extended darwin/amd64)
参考URL https://forestry.io/blog/build-a-json-api-with-hugo/
やったこと config.tomlにoutput formatを追加 以下の内容を追加。HTMLのページ自体はそのまま残したいのでHTMLとJSONを指定する。
[outputs] home = [&#34;HTML&#34;, &#34;JSON&#34;] section = [&#34;HTML&#34;, &#34;JSON&#34;] page = [&#34;HTML&#34;, &#34;JSON&#34;] テンプレートを作成 layouts/_default 配下に以下のファイルを作成する。
ファイル名は {pageKind}.{outputFormatName}.{extension} という形式になる。今回は outputFormatName=json、 extension=jsonとなるので、JSON形式の出力の共通部分を記述した baseof、リスト表示用の list、単体表示用の single、それらの中で表示する1要素を表すための itemの4つを作成する。
 baseof.json.json item.json.json single.json.json list.json.json  layouts/_default/baseof.json.json { &#34;data&#34; : {{ block &#34;response&#34; .}}{{ end }} } このブログのJSONレスポンスは全てdata プロパティとして response ブロックをレンダリングして返す。 各 pageKindでは responseを定義する。
layouts/_default/item.json.json { &#34;title&#34;: &#34;{{ .Title }}&#34;, &#34;date&#34;: &#34;{{ ."></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><h1 class=site-title><a href=/>常にいまいち</a></h1><nav></nav></header><main id=main tabindex=-1><article class=post><header class=post-header><h1 class=post-title>Hugo as JSON API</h1></header><div class=content><h2 id=やりたいこと>やりたいこと</h2><p>Hugoでブログを始めたものの、JSONでコンテンツをみることができると嬉しいので方法を調べてみた。<br>ビルドに使用しているのはMac上のHugo(<strong>Hugo Static Site Generator v0.62.0/extended darwin/amd64</strong>)</p><h2 id=参考url>参考URL</h2><p><a href=https://forestry.io/blog/build-a-json-api-with-hugo/>https://forestry.io/blog/build-a-json-api-with-hugo/</a></p><h2 id=やったこと>やったこと</h2><h3 id=configtomlにoutput-formatを追加>config.tomlにoutput formatを追加</h3><p>以下の内容を追加。HTMLのページ自体はそのまま残したいのでHTMLとJSONを指定する。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml>[outputs]
home = [<span style=color:#87ceeb>&#34;HTML&#34;</span>, <span style=color:#87ceeb>&#34;JSON&#34;</span>]
section = [<span style=color:#87ceeb>&#34;HTML&#34;</span>, <span style=color:#87ceeb>&#34;JSON&#34;</span>]
page = [<span style=color:#87ceeb>&#34;HTML&#34;</span>, <span style=color:#87ceeb>&#34;JSON&#34;</span>]
</code></pre></div><h3 id=テンプレートを作成>テンプレートを作成</h3><p><strong>layouts/_default</strong> 配下に以下のファイルを作成する。<br>ファイル名は <strong>{pageKind}.{outputFormatName}.{extension}</strong> という形式になる。今回は <strong>outputFormatName=json</strong>、 <strong>extension=json</strong>となるので、JSON形式の出力の共通部分を記述した <strong>baseof</strong>、リスト表示用の <strong>list</strong>、単体表示用の <strong>single</strong>、それらの中で表示する1要素を表すための <strong>item</strong>の4つを作成する。</p><ul><li>baseof.json.json</li><li>item.json.json</li><li>single.json.json</li><li>list.json.json</li></ul><h4 id=layouts_defaultbaseofjsonjson>layouts/_default/baseof.json.json</h4><pre><code>{
    &quot;data&quot; : {{ block &quot;response&quot; .}}{{ end }}
}
</code></pre><p>このブログのJSONレスポンスは全て<strong>data</strong> プロパティとして <strong>response</strong> ブロックをレンダリングして返す。
各 <strong>pageKind</strong>では <strong>response</strong>を定義する。</p><h4 id=layouts_defaultitemjsonjson>layouts/_default/item.json.json</h4><pre><code>{
  &quot;title&quot;: &quot;{{ .Title }}&quot;,
  &quot;date&quot;: &quot;{{ .Date }}&quot;,
  &quot;draft&quot;: &quot;{{ .Draft }}&quot;,
  &quot;content&quot;: &quot;{{ .Content }}&quot;
}
</code></pre><p>ページのコンテンツから <strong>title</strong>、 <strong>date</strong>、 <strong>draft</strong>、 <strong>content</strong> を返すことにする。<br>今後必要な項目が発生した場合はこれに追記することになる。</p><p><strong>追記</strong><br>このやり方では <strong>content</strong> にダブルクォーテーションなどが入った場合のエスケープが不十分なので<a href=../fix-json-api-bug/>別途修正が必要</a>。</p><h4 id=layouts_defaultsinglejsonjson>layouts/_default/single.json.json</h4><pre><code>{{ define &quot;response&quot; }} {{ .Render &quot;item&quot; }} {{ end }}
</code></pre><p>singleはコンテンツ1ページ分を返すためのpageKindなので、
itemをレンダリングして <strong>response</strong> を定義する。<br>実際に表示すると以下のようになる。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  &#34;data&#34;: {
    &#34;title&#34;: <span style=color:#87ceeb>&#34;First Post&#34;</span>,
    &#34;date&#34;: <span style=color:#87ceeb>&#34;2020-01-01 18:44:41 +0900 JST&#34;</span>,
    &#34;draft&#34;: <span style=color:#87ceeb>&#34;false&#34;</span>,
    &#34;content&#34;: <span style=color:#87ceeb>&#34;&lt;p&gt;ブログを放置しっぱなしだったので作り直してみる。&lt;br&gt;とりあえず手っ取り早くできる &lt;strong&gt;hugo + Github Page&lt;/strong&gt; で作り直した。&lt;/p&gt;&#34;</span>
  }
}
</code></pre></div><p>注: 見やすいように改行/空白の調整をしています。</p><h4 id=layouts_defaultlistjsonjson>layouts/_default/list.json.json</h4><pre><code>{{ define &quot;response&quot; }}
{
  {{ with .Section }}
  &quot;section&quot; : &quot;{{ . }}&quot;,
  {{ end }}
  &quot;count&quot; : &quot;{{ len .Data.Pages }}&quot;,
  &quot;items&quot; : [
  {{ range $i, $e := .Data.Pages }}
  {{ if $i }}, {{ end }}{{ .Render &quot;item&quot; }}
  {{ end }}
  ]
}
{{ end }}
</code></pre><p>listは複数のページを返すためのpageKindなので、<strong>Section</strong>が有ればそれと、含まれる <strong>page</strong>の数、及びそれぞれの <strong>page</strong> についての <strong>item</strong> をレンダリングする形で <strong>response</strong> を定義します。</p><h2 id=結果の確認>結果の確認</h2><p>コンテンツを <strong>contents/posts</strong> 配下に作っているものとする。</p><h3 id=listsectionあり>list(Sectionあり)</h3><p><a href=http://localhost:1313/index.json>http://localhost:1313/index.json</a></p><h3 id=listsectionなし>list(Sectionなし)</h3><p><a href=http://localhost:1313/posts/index.json>http://localhost:1313/posts/index.json</a></p><h3 id=single>single</h3><p><a href=http://localhost:1313/posts/my-first-post/index.json>http://localhost:1313/posts/my-first-post/index.json</a><br>(コンテンツ名が <strong>my-first-post</strong> の場合)</p></div><div class=post-info><div class=post-date>2020-01-01</div><div class=post-taxonomies></div></div></article><div class="pagination post-pagination"><div class="left pagination-item"><a href=/posts/fix-json-api-bug/>JSON APIのバグ修正</a></div><div class="right pagination-item"><a href=/posts/first-post/>First Post</a></div></div></main><footer class=common-footer><div class=copyright><p>© ques0942, 2021<br>Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/mitrichius/hugo-theme-anubis>Anubis</a>.</p></div></footer></div></body></html>
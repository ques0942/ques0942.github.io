<!doctype html><html lang=en-us data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>[„É°„É¢]GitHub Actions„Åßterraform plan & apply„Åô„Çã - Â∏∏„Å´„ÅÑ„Åæ„ÅÑ„Å°</title><meta name=description content="blog for something"><link rel=icon type=image/x-icon href=https://blog.app.melvins-nest.com/favicon.ico><link rel=apple-touch-icon-precomposed href=https://blog.app.melvins-nest.com/favicon.png><link rel=stylesheet href="https://blog.app.melvins-nest.com/css/light.css?rnd=1607129636"><style>[data-theme=dark]{--font-color: #eee;--bg-color: #212121;--link-color:#599ada;--link-state-color:#ff5858;--link-state-border-color: rgba(238, 54, 54, 0.5);--thead-bg-color: #343a40;--table-border-color: lightgrey;--pre-color: #333;--pre-bg-color: #f1f1f1;--bq-color: #ccc;--hr-color: #333;--pagination-bg-color: #373737;--pagination-link-color: #b6b6b6;--post-info-color: grey;--switcher-color: #333;--switcher-bg-color: #fff}</style><link rel=stylesheet href="https://blog.app.melvins-nest.com/css/style.css?rnd=1607129636"><meta property="og:title" content="[„É°„É¢]GitHub Actions„Åßterraform plan & apply„Åô„Çã"><meta property="og:description" content="Github Actions„Çí‰Ωø„Å£„Å¶PR„Éô„Éº„Çπ„Åßterraform plan„ÇíÊ§úË®º„Åó„ÄÅmaster„Éû„Éº„Ç∏„Åï„Çå„ÅüÂÆöÁæ©„Çíterraform apply„Åß„Ç§„É≥„Éï„É©„Å´ÈÅ©Áî®„Åô„Çã„ÄÇ"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.app.melvins-nest.com/posts/660599770/"><meta property="article:published_time" content="2020-07-19T16:31:55+00:00"><meta property="article:modified_time" content="2020-07-19T16:31:55+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="[„É°„É¢]GitHub Actions„Åßterraform plan & apply„Åô„Çã"><meta name=twitter:description content="Github Actions„Çí‰Ωø„Å£„Å¶PR„Éô„Éº„Çπ„Åßterraform plan„ÇíÊ§úË®º„Åó„ÄÅmaster„Éû„Éº„Ç∏„Åï„Çå„ÅüÂÆöÁæ©„Çíterraform apply„Åß„Ç§„É≥„Éï„É©„Å´ÈÅ©Áî®„Åô„Çã„ÄÇ"></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><h1 class=site-title><a href=/>Â∏∏„Å´„ÅÑ„Åæ„ÅÑ„Å°</a></h1><nav></nav></header><main id=main tabindex=-1><article class=post><header class=post-header><h1 class=post-title>[„É°„É¢]GitHub Actions„Åßterraform plan & apply„Åô„Çã</h1></header><div class=content><p>Github Actions„Çí‰Ωø„Å£„Å¶PR„Éô„Éº„Çπ„Åßterraform plan„ÇíÊ§úË®º„Åó„ÄÅmaster„Éû„Éº„Ç∏„Åï„Çå„ÅüÂÆöÁæ©„Çíterraform apply„Åß„Ç§„É≥„Éï„É©„Å´ÈÅ©Áî®„Åô„Çã„ÄÇ</p><h1 id=ÊúÄÁµÇÁöÑ„Å™yaml>ÊúÄÁµÇÁöÑ„Å™yaml</h1><div class=highlight><pre style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:red>name</span>: <span style=color:#87ceeb>&#34;terraform&#34;</span>

<span style=color:red>on</span>:
  <span style=color:red>push</span>:
    <span style=color:red>branches</span>:
      - master
  <span style=color:red>pull_request</span>:
    <span style=color:red>types</span>: [opened, synchronize, reopened]

<span style=color:red>env</span>:
  <span style=color:red>GOOGLE_APPLICATION_CREDENTIALS_KEY</span>: ${{ secrets.GOOGLE_APPLICATION_CREDENTIALS_KEY }}
  <span style=color:red>GOOGLE_APPLICATION_CREDENTIALS</span>: /tmp/credentials.json

<span style=color:red>jobs</span>:
  <span style=color:red>terraform</span>:
    <span style=color:red>name</span>: <span style=color:#87ceeb>&#34;terraform&#34;</span>
    <span style=color:red>runs-on</span>: <span style=color:#87ceeb>&#34;ubuntu-latest&#34;</span>
    <span style=color:red>env</span>:
      <span style=color:red>GOOGLE_APPLICATION_CREDENTIALS</span>: /tmp/credentials.json
    <span style=color:red>steps</span>:
    - <span style=color:red>name</span>: checkout
      <span style=color:red>uses</span>: actions/checkout@v2
    - <span style=color:red>name</span>: setup terraform
      <span style=color:red>uses</span>: hashicorp/setup-terraform@v1
    - <span style=color:red>name</span>: copy credentials
      <span style=color:red>run</span>: echo ${GOOGLE_APPLICATION_CREDENTIALS_KEY} &gt; ${GOOGLE_APPLICATION_CREDENTIALS}
    - <span style=color:red>name</span>: init
      <span style=color:red>id</span>: init
      <span style=color:red>run</span>: terraform init
    - <span style=color:red>name</span>: validate
      <span style=color:red>id</span>: validate
      <span style=color:red>run</span>: terraform validate -no-color
      <span style=color:red>continue-on-error</span>: <span style=color:red>true</span>
    - <span style=color:red>name</span>: format check
      <span style=color:red>id</span>: fmt
      <span style=color:red>run</span>: terraform fmt -check -diff
      <span style=color:red>continue-on-error</span>: <span style=color:red>true</span>
    - <span style=color:red>name</span>: plan
      <span style=color:red>id</span>: plan
      <span style=color:red>run</span>: terraform plan -no-color
      <span style=color:red>continue-on-error</span>: <span style=color:red>true</span>
    - <span style=color:red>name</span>: remove old comment
      <span style=color:red>id</span>: remove_old_comment
      <span style=color:red>uses</span>: actions/github-script@<span style=color:#f60>0.9.0</span>
      <span style=color:red>if</span>: github.event_name == <span style=color:#87ceeb>&#39;pull_request&#39;</span>
      <span style=color:red>with</span>:
        <span style=color:red>github-token</span>: ${{ secrets.GITHUB_TOKEN }}
        <span style=color:red>script</span>: <span style=color:#87ceeb>|
</span><span style=color:#87ceeb>          opts = github.issues.listComments.endpoint.merge({</span>
            <span style=color:red>owner</span>: context.repo.owner,
            <span style=color:red>repo</span>: context.repo.repo,
            <span style=color:red>issue_number</span>: context.issue.number,
            <span style=color:red>per_page</span>: <span style=color:#f60>100</span>,
          })
          const comments = await github.paginate(opts)
          for(const comment of comments) {
            if (comment.user.login === <span style=color:#87ceeb>&#34;github-actions[bot]&#34;</span> <span style=color:#e5e5e5>&amp;&amp;</span> comment.body.startsWith(<span style=color:#87ceeb>&#34;#### Terraform Format and Style&#34;</span>)) {
              github.issues.deleteComment({
                <span style=color:red>owner</span>: context.repo.owner,
                <span style=color:red>repo</span>: context.repo.repo,
                <span style=color:red>comment_id</span>: comment.id,
              })
            }
          }
    - <span style=color:red>name</span>: show plan
      <span style=color:red>uses</span>: actions/github-script@<span style=color:#f60>0.9.0</span>
      <span style=color:red>if</span>: github.event_name == <span style=color:#87ceeb>&#39;pull_request&#39;</span>
      <span style=color:red>env</span>:
        <span style=color:red>PLAN</span>: <span style=color:#87ceeb>&#34;terraform\n${{ steps.plan.outputs.stdout }}&#34;</span>
      <span style=color:red>with</span>:
        <span style=color:red>github-token</span>: ${{ secrets.GITHUB_TOKEN }}
        <span style=color:red>script</span>: <span style=color:#87ceeb>|
</span><span style=color:#87ceeb>          const output = `#### Terraform Format and Style üñå\`${{ steps.fmt.outcome }}\`</span>
          <span style=color:#0f0>#### Terraform Initialization: \`${{ steps.init.outcome }}\`</span>
          <span style=color:#0f0>#### Terraform Validation: ${{ steps.validate.outputs.stdout }}</span>
          <span style=color:#0f0>#### Terraform Format: ${{ steps.fmt.outputs.stdout }} </span>
          <span style=color:#0f0>#### Terraform Plan: \`${{ steps.plan.outcome }}\`</span>
          &lt;details&gt;&lt;summary&gt;Show Plan&lt;/summary<span style=color:#87ceeb>&gt;
</span><span style=color:#87ceeb>          \`\`\`${process.env.PLAN}\`\`\`</span>
          &lt;/details<span style=color:#87ceeb>&gt;
</span><span style=color:#87ceeb>          *Pusher: @${{ github.actor }}, Action: \`${{ github.event_name }}\`,  Workflow: \`${{ github.workflow }}\`*`;</span>
          github.issues.createComment({
            <span style=color:red>issue_number</span>: context.issue.number,
            <span style=color:red>owner</span>: context.repo.owner,
            <span style=color:red>repo</span>: context.repo.repo,
            <span style=color:red>body</span>: output
          })
    - <span style=color:red>name</span>: check on failure
      <span style=color:red>if</span>: steps.validate.outcome == <span style=color:#87ceeb>&#39;failure&#39;</span> || steps.fmt.outcome == <span style=color:#87ceeb>&#39;failure&#39;</span> || steps.plan.outcome == <span style=color:#87ceeb>&#39;failure&#39;</span>
      <span style=color:red>run</span>: <span style=color:#87ceeb>|
</span><span style=color:#87ceeb>        echo ${{ steps.validate.outputs.status }} </span>
        echo ${{ steps.fmt.outputs.status }}
        echo ${{ steps.plan.outputs.status }}
        exit <span style=color:#f60>1</span>
    - <span style=color:red>name</span>: apply
      <span style=color:red>if</span>: github.ref == <span style=color:#87ceeb>&#39;refs/heads/master&#39;</span> <span style=color:#e5e5e5>&amp;&amp;</span> github.event_name == <span style=color:#87ceeb>&#39;push&#39;</span>
      <span style=color:red>run</span>: terraform apply -auto-approve
</code></pre></div><h1 id=Ë™¨Êòé>Ë™¨Êòé</h1><h2 id=action„ÇíÁô∫ÁÅ´„Åï„Åõ„Çã„Ç§„Éô„É≥„Éà>Action„ÇíÁô∫ÁÅ´„Åï„Åõ„Çã„Ç§„Éô„É≥„Éà</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:red>on</span>:
  <span style=color:red>push</span>:
    <span style=color:red>branches</span>:
      - master
  <span style=color:red>pull_request</span>:
    <span style=color:red>types</span>: [opened, synchronize, reopened]
</code></pre></div><p>master„Å´„Éû„Éº„Ç∏„Åï„Çå„ÅüÊôÇ„Å´terraform apply„Åó„Åü„ÅÑ„ÅÆ„Åßmaster„Å´ÂØæ„Åô„Çãpush„Ç§„Éô„É≥„Éà„Çí„ÄÅ
PR„Åå‰ΩúÊàê„ÄÅÊõ¥Êñ∞„Åï„Çå„Åüterraform plan„Åó„Åü„ÅÑ„ÅÆ„Åßpull_request„ÅÆopen/synchronize/reopened„Ç§„Éô„É≥„Éà„ÇíÂØæË±°„Å´„Åô„Çã(ÂÆüÈöõ„ÅÆ„Å®„Åì„Çç<a href=https://docs.github.com/en/actions/reference/events-that-trigger-workflows#pull_request>pull_request„Å®„Å†„ÅëÊåáÂÆö„Åô„Çå„Å∞„Åì„ÅÆ3„Å§„ÇíÂØæË±°„Å´„Åó„Åü„Åì„Å®„Å´„Å™„Çã</a>)
pull_request„ÅÆsynchronize„ÅØ<a href=https://github.community/t/what-is-a-pull-request-synchronize-event/14784>PR„ÅÆ„ÇΩ„Éº„Çπ„Éñ„É©„É≥„ÉÅ„ÅåÊõ¥Êñ∞„Åï„Çå„Åü„Å®„Åç„Å´Áô∫Ë°å„Åï„Çå„Çã</a>„ÄÇ</p><h2 id=credential>credential</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:red>env</span>:
  <span style=color:red>GOOGLE_APPLICATION_CREDENTIALS_KEY</span>: ${{ secrets.GOOGLE_APPLICATION_CREDENTIALS_KEY }}
  <span style=color:red>GOOGLE_APPLICATION_CREDENTIALS</span>: /tmp/credentials.json
</code></pre></div><p>Secrets„Å´‰∫à„ÇÅservice account„ÅÆjson„ÇíÁôªÈå≤„Åó„Å¶„Åä„Åè„ÄÇ
<code>GOOGLE_APPLICATION_CREDENTIALS</code> „ÇíÂÆöÁæ©„Åó„Å¶„Åä„Åè„Å®terraform„Åå„Åù„Çå„ÇíË™≠„ÅøÂèñ„Å£„Å¶„Åè„Çå„Çã„ÅÆ„Åß‰ªäÂõû„ÅØ„Åì„ÅÆÊñπÊ≥ï„Åßcredential„ÇíÊ∏°„Åô„Åì„Å®„Å´„Åó„Åü„ÄÇ</p><h2 id=workflow„ÅÆË™¨Êòé>workflow„ÅÆË™¨Êòé</h2><h3 id=checkout„Åæ„Åß>checkout„Åæ„Åß</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:red>jobs</span>:
  <span style=color:red>terraform</span>:
    <span style=color:red>name</span>: <span style=color:#87ceeb>&#34;terraform&#34;</span>
    <span style=color:red>runs-on</span>: <span style=color:#87ceeb>&#34;ubuntu-latest&#34;</span>
    <span style=color:red>env</span>:
      <span style=color:red>GOOGLE_APPLICATION_CREDENTIALS</span>: /tmp/credentials.json
    <span style=color:red>steps</span>:
    - <span style=color:red>name</span>: checkout
      <span style=color:red>uses</span>: actions/checkout@v2
</code></pre></div><p>„Åì„Åì„Åæ„Åß„ÅØ„ÉÜ„É≥„Éó„É¨</p><h3 id=terraform„ÅÆÂ∞éÂÖ•>terraform„ÅÆÂ∞éÂÖ•</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>    - <span style=color:red>name</span>: setup terraform
      <span style=color:red>uses</span>: hashicorp/setup-terraform@v1
</code></pre></div><p><a href=https://github.com/hashicorp/setup-terraform>HashicorpÂÖ¨Âºè„ÅÆaction</a>„Åå„ÅÇ„Çã„ÅÆ„Åß„Åì„Çå„Çí‰Ωø„ÅÜ„ÄÇ
terraform„ÅÆversionÊåáÂÆö„Å™„Å©„ÇÇ„Åß„Åç„Çã„ÅÆ„ÅßÂøÖË¶Å„Å™„ÇâË®≠ÂÆö„Åô„Çã„ÄÇREADME„Å´‰Ωø„ÅÑÊñπ„ÅØÂ§ß‰ΩìÊõ∏„ÅÑ„Å¶„ÅÇ„Çã„ÄÇ</p><h3 id=credential„ÅÆÊõ∏„ÅçÂá∫„Åó>credential„ÅÆÊõ∏„ÅçÂá∫„Åó</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>    - <span style=color:red>name</span>: copy credentials
      <span style=color:red>run</span>: echo ${GOOGLE_APPLICATION_CREDENTIALS_KEY} &gt; ${GOOGLE_APPLICATION_CREDENTIALS}
</code></pre></div><p><code>GOOGLE_APPLICATION_CREDENTIALS</code> „ÅßÊåáÂÆö„Åó„Åü„Éë„Çπ„Å´service account„Ç≠„Éº„ÇíÊõ∏„ÅçÂá∫„Åó„Å¶„Åä„Åè„ÄÇ</p><h3 id=terraform„ÅÆÂêÑÁ®Æ„ÉÅ„Çß„ÉÉ„ÇØ„Å®plan„ÅÆÂÆüË°å>terraform„ÅÆÂêÑÁ®Æ„ÉÅ„Çß„ÉÉ„ÇØ„Å®plan„ÅÆÂÆüË°å</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>    - <span style=color:red>name</span>: init
      <span style=color:red>id</span>: init
      <span style=color:red>run</span>: terraform init
    - <span style=color:red>name</span>: validate
      <span style=color:red>id</span>: validate
      <span style=color:red>run</span>: terraform validate -no-color
      <span style=color:red>continue-on-error</span>: <span style=color:red>true</span>
    - <span style=color:red>name</span>: format check
      <span style=color:red>id</span>: fmt
      <span style=color:red>run</span>: terraform fmt -check -diff
      <span style=color:red>continue-on-error</span>: <span style=color:red>true</span>
    - <span style=color:red>name</span>: plan
      <span style=color:red>id</span>: plan
      <span style=color:red>run</span>: terraform plan -no-color
      <span style=color:red>continue-on-error</span>: <span style=color:red>true</span>
</code></pre></div><p>init/validate/fmt/plan„Çí„Åù„Çå„Åû„ÇåÂÆüË°å„Åó„Å¶ÁµêÊûú„ÇíÂèéÈõÜ„Åô„Çã„ÄÇ
validate/plan„Åß <code>-no-color</code> „Çí„Å§„ÅëÂøò„Çå„Çã„Å®Âá∫Âäõ„Å´„Ç´„É©„Éº„Ç≥„Éº„Éâ„ÅåÂÖ•„ÇäËæº„ÇÄ„ÅÆ„ÅßÊ≥®ÊÑè„ÄÇ</p><p><code>continue-on-error: true</code> „Å®„Åó„Å¶„ÅÑ„Çã„ÅÆ„ÅØÂêÑÁ®Æ„ÉÅ„Çß„ÉÉ„ÇØ„ÅÆÁµêÊûú„ÇíPR„Å´„Ç≥„É°„É≥„Éà„Å®„Åó„Å¶Êõ∏„ÅçÂá∫„ÅôÂá¶ÁêÜ„ÇíË°å„ÅÜ„Åü„ÇÅ„ÄÇ
„Åì„ÅÆË®òËø∞„ÇíÁúÅ„Åè„Å®„ÅÑ„Åö„Çå„Åã„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„ÅßÂ§±Êïó„Åô„Çã„Å®„Åù„Åì„Åß‰∏≠Êñ≠„Åô„Çã„ÄÇ
„Ç≥„É°„É≥„Éà„ÇíÊõ∏„ÅçÂá∫„ÅôÂøÖË¶Å„Åå„Å™„Åë„Çå„Å∞„Åù„ÅÜ„Åó„Å¶„Åó„Åæ„Åà„Å∞ËâØ„ÅÑ„ÄÇ</p><h3 id=Âè§„ÅÑ„Ç≥„É°„É≥„Éà„ÅÆÂâäÈô§>Âè§„ÅÑ„Ç≥„É°„É≥„Éà„ÅÆÂâäÈô§</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>    - <span style=color:red>name</span>: remove old comment
      <span style=color:red>id</span>: remove_old_comment
      <span style=color:red>uses</span>: actions/github-script@<span style=color:#f60>0.9.0</span>
      <span style=color:red>if</span>: github.event_name == <span style=color:#87ceeb>&#39;pull_request&#39;</span>
      <span style=color:red>with</span>:
        <span style=color:red>github-token</span>: ${{ secrets.GITHUB_TOKEN }}
        <span style=color:red>script</span>: <span style=color:#87ceeb>|
</span><span style=color:#87ceeb>          opts = github.issues.listComments.endpoint.merge({</span>
            <span style=color:red>owner</span>: context.repo.owner,
            <span style=color:red>repo</span>: context.repo.repo,
            <span style=color:red>issue_number</span>: context.issue.number,
            <span style=color:red>per_page</span>: <span style=color:#f60>100</span>,
          })
          const comments = await github.paginate(opts)
          for(const comment of comments) {
            if (comment.user.login === <span style=color:#87ceeb>&#34;github-actions[bot]&#34;</span> <span style=color:#e5e5e5>&amp;&amp;</span> comment.body.startsWith(<span style=color:#87ceeb>&#34;#### Terraform Format and Style&#34;</span>)) {
              github.issues.deleteComment({
                <span style=color:red>owner</span>: context.repo.owner,
                <span style=color:red>repo</span>: context.repo.repo,
                <span style=color:red>comment_id</span>: comment.id,
              })
            }
          }
</code></pre></div><p>„Åì„ÅÆaction„ÇíË§áÊï∞ÂõûÂÆüË°å„Åô„Çã„Å®ÈÉΩÂ∫¶„Ç≥„É°„É≥„Éà„ÅåÂ¢ó„Åà„Å¶„Åó„Åæ„ÅÜ„ÅÆ„Åß„ÄÅ
<a href=https://github.com/actions/github-script>github-script</a>„ÇíÁî®„ÅÑ„Å¶Âè§„ÅÑ„Ç≥„É°„É≥„Éà„ÇíÂâäÈô§„Åô„Çã„ÄÇ
ÈÄöÂ∏∏„Åù„Çì„Å™„Å´„Åü„Åè„Åï„Çì„Ç≥„É°„É≥„Éà„Åå‰ªò„Åè„Åì„Å®„ÅØÁÑ°„ÅÑ„Å®ÊÄù„ÅÜ„Åå„ÄÅ
Âøµ„ÅÆÁÇ∫„Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥„Åó„Å¶ÂÖ®ÈÉ®„ÅÆ„Ç≥„É°„É≥„Éà„ÇíÂèñ„ÇäÂá∫„Åó„Å¶„ÄÅgithub actions„Åã„Çâ„Å§„Åë„Çâ„Çå„Åü„Ç≥„É°„É≥„Éà„Åã„Å§Êú¨Êñá„Åå„Åì„ÅÆaction„Åß‰ªò‰∏é„Åó„Åü„ÇÇ„ÅÆ„Å®È°û‰ºº„Åô„Çã„ÇÇ„ÅÆ„ÇíÂâäÈô§„Åó„Å¶„ÅÑ„Çã„ÄÇ</p><p>github-script„ÅÆ‰Ωø„ÅÑÊñπ„ÅØ„Åì„ÅÆ„ÅÇ„Åü„Çä„ÇíÂèÇËÄÉ„Å´„Åó„Åü„ÄÇ</p><ul><li><a href=https://github.com/actions/github-script#welcome-a-first-time-contributor>https://github.com/actions/github-script#welcome-a-first-time-contributor</a></li><li><a href=https://octokit.github.io/rest.js/>https://octokit.github.io/rest.js/</a></li><li><a href=https://maku.blog/p/7r6gr3d/>https://maku.blog/p/7r6gr3d/</a></li></ul><h3 id=„ÉÅ„Çß„ÉÉ„ÇØplan„ÅÆÁµêÊûú„Çí„Ç≥„É°„É≥„Éà„Å®„Åó„Å¶Êõ∏„ÅçÂá∫„Åô>„ÉÅ„Çß„ÉÉ„ÇØ„ÄÅplan„ÅÆÁµêÊûú„Çí„Ç≥„É°„É≥„Éà„Å®„Åó„Å¶Êõ∏„ÅçÂá∫„Åô</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>    - <span style=color:red>name</span>: show plan
      <span style=color:red>uses</span>: actions/github-script@<span style=color:#f60>0.9.0</span>
      <span style=color:red>if</span>: github.event_name == <span style=color:#87ceeb>&#39;pull_request&#39;</span>
      <span style=color:red>env</span>:
        <span style=color:red>PLAN</span>: <span style=color:#87ceeb>&#34;terraform\n${{ steps.plan.outputs.stdout }}&#34;</span>
      <span style=color:red>with</span>:
        <span style=color:red>github-token</span>: ${{ secrets.GITHUB_TOKEN }}
        <span style=color:red>script</span>: <span style=color:#87ceeb>|
</span><span style=color:#87ceeb>          const output = `#### Terraform Format and Style üñå\`${{ steps.fmt.outcome }}\`</span>
          <span style=color:#0f0>#### Terraform Initialization: \`${{ steps.init.outcome }}\`</span>
          <span style=color:#0f0>#### Terraform Validation: ${{ steps.validate.outputs.stdout }}</span>
          <span style=color:#0f0>#### Terraform Format: ${{ steps.fmt.outputs.stdout }} </span>
          <span style=color:#0f0>#### Terraform Plan: \`${{ steps.plan.outcome }}\`</span>
          &lt;details&gt;&lt;summary&gt;Show Plan&lt;/summary<span style=color:#87ceeb>&gt;
</span><span style=color:#87ceeb>          \`\`\`${process.env.PLAN}\`\`\`</span>
          &lt;/details<span style=color:#87ceeb>&gt;
</span><span style=color:#87ceeb>          *Pusher: @${{ github.actor }}, Action: \`${{ github.event_name }}\`,  Workflow: \`${{ github.workflow }}\`*`;</span>
          github.issues.createComment({
            <span style=color:red>issue_number</span>: context.issue.number,
            <span style=color:red>owner</span>: context.repo.owner,
            <span style=color:red>repo</span>: context.repo.repo,
            <span style=color:red>body</span>: output
          })
</code></pre></div><p>ÈÅ©ÂΩì„Å™„Éï„Ç©„Éº„Éû„ÉÉ„Éà„ÅßPR„Å´„Ç≥„É°„É≥„Éà„Å®„Åó„Å¶ÁµêÊûú„ÇíÊõ∏„ÅçÂá∫„Åô„ÄÇ
ÂΩìÁÑ∂„Å™„Åå„ÇâÊõ∏„ÅçÂá∫„ÅôÂÖà„ÅÆPR„ÅåÁÑ°„ÅÑ„Å®Âãï„Åã„Å™„ÅÑ„ÅÆ„Åß„ÄÅ<code>if</code>„Åßevent_name„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Å¶pull_request„Å†„Åë„ÇíÂØæË±°„Å´„Åô„Çã„ÄÇ</p><h3 id=„ÉÅ„Çß„ÉÉ„ÇØplan„Å´‰∏çÂÇô„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„Ç®„É©„ÉºÁµÇ‰∫Ü„Åï„Åõ„Çã>„ÉÅ„Çß„ÉÉ„ÇØ„ÄÅplan„Å´‰∏çÂÇô„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„Ç®„É©„ÉºÁµÇ‰∫Ü„Åï„Åõ„Çã</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:red>name</span>: check on failure
      <span style=color:red>if</span>: steps.validate.outcome == <span style=color:#87ceeb>&#39;failure&#39;</span> || steps.fmt.outcome == <span style=color:#87ceeb>&#39;failure&#39;</span> || steps.plan.outcome == <span style=color:#87ceeb>&#39;failure&#39;</span>
      <span style=color:red>run</span>: exit <span style=color:#f60>1</span>
</code></pre></div><p>‰∏çÂÇô„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„Éû„Éº„Ç∏„Åß„Åç„Å™„ÅÑ„Çà„ÅÜ„Å´„Åó„Åü„ÅÑ„ÅÆ„Åß„ÄÅÁµÇ‰∫Ü„Çπ„ÉÜ„Éº„Çø„Çπ„Çí„Åù„Çå„Åû„Çå„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Å¶„Å©„Çå„Åã‰∏Ä„Å§„Åß„ÇÇÂ§±Êïó„Åó„Å¶„ÅÑ„Åü„Çâ„Ç®„É©„ÉºÁµÇ‰∫Ü„Åï„Åõ„Çã„ÄÇ</p><h3 id=terraform-apply„Åô„Çã>terraform apply„Åô„Çã</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>    - <span style=color:red>name</span>: apply
      <span style=color:red>if</span>: github.ref == <span style=color:#87ceeb>&#39;refs/heads/master&#39;</span> <span style=color:#e5e5e5>&amp;&amp;</span> github.event_name == <span style=color:#87ceeb>&#39;push&#39;</span>
      <span style=color:red>run</span>: terraform apply -auto-approve
</code></pre></div><p>ÁÑ°‰∫ã„Å´master„Å´„Éû„Éº„Ç∏„Åï„Çå„Åü„Çâapply„Åó„Å¶Â§âÊõ¥ÂÜÖÂÆπ„Çí„Ç§„É≥„Éï„É©„Å´ÂèçÊò†„Åï„Åõ„Çã„ÄÇ
ÂÆüË°åÁ¢∫Ë™ç„ÅåÂá∫„Å™„ÅÑ„Çà„ÅÜ„Å´ <code>-auto-approve</code> „Çí„Å§„Åë„Å¶ÂÆüË°å„Åô„Çã„ÄÇ</p></div><div class=post-info><div class=post-date>2020-07-19</div><div class=post-taxonomies></div></div></article><div class="pagination post-pagination"><div class="left pagination-item"><a href=/posts/661465923/>[„É°„É¢]BigQuery„ÇíDataGrip„Åã„Çâ‰ΩøÁî®„Åô„Çã</a></div><div class="right pagination-item"><a href=/posts/629278766/>Kubernetes„ÅÆenv„ÅØÂæåÂãù„Å°</a></div></div></main><footer class=common-footer><div class=copyright><p>¬© ques0942, 2020<br>Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/mitrichius/hugo-theme-anubis>Anubis</a>.</p></div></footer></div></body></html>
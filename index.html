<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.62.0"><meta name=viewport content="width=device-width,initial-scale=1"><title>常にいまいち</title><meta name=description content="blog for something"><link type=text/css rel=stylesheet href=/css/print.css media=print><link type=text/css rel=stylesheet href=/css/poole.css><link type=text/css rel=stylesheet href=/css/syntax.css><link type=text/css rel=stylesheet href=/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=/><h1>常にいまいち</h1></a><p class=lead>blog for something</p></div><nav><ul class=sidebar-nav><li><a href=/>Home</a></li></ul></nav><p>&copy; 2020. All rights reserved.</p></div></aside><main class="content container"><div class=posts><article class=post><h1 class=post-title><a href=/posts/fix-json-api-bug/>JSON APIのバグ修正</a></h1><time datetime=2020-01-02T00:09:00+0900 class=post-date>Thu, Jan 2, 2020</time>
前回の記事の内容ではコンテンツにダブルクォーテーションなどのエスケープが必要な文字が入った場合にJSONとして不適切なレスポンスになるため修正する。
解決策 item.json.json を以下のように修正する
{{- dict "title" .Title "date" .Date "draft" .Draft "content" .Content | jsonify -}} 問題点 元々のitem.json.jsonでは、元データを変換せずにそのままレンダリングしてしまっていることが原因のため、何らかのエスケープを行えば解決する。
今回は以下のページを参考に、dictを作成してjsonifyで変換することにした。
https://gohugo.io/functions/jsonify/#readout https://knooto.info/hugo-snippets/#json%E5%87%BA%E5%8A%9B https://blog.8-p.info/ja/2018/05/26/hugo-json/</article><article class=post><h1 class=post-title><a href=/posts/hugo-as-json-api/>Hugo as JSON API</a></h1><time datetime=2020-01-01T23:11:43+0900 class=post-date>Wed, Jan 1, 2020</time>
やりたいこと Hugoでブログを始めたものの、JSONでコンテンツをみることができると嬉しいので方法を調べてみた。
ビルドに使用しているのはMac上のHugo(Hugo Static Site Generator v0.62.0/extended darwin/amd64)
参考URL https://forestry.io/blog/build-a-json-api-with-hugo/
やったこと config.tomlにoutput formatを追加 以下の内容を追加。HTMLのページ自体はそのまま残したいのでHTMLとJSONを指定する。
[outputs] home = ["HTML", "JSON"] section = ["HTML", "JSON"] page = ["HTML", "JSON"] テンプレートを作成 layouts/_default 配下に以下のファイルを作成する。
ファイル名は {pageKind}.{outputFormatName}.{extension} という形式になる。今回は outputFormatName=json、 extension=jsonとなるので、JSON形式の出力の共通部分を記述した baseof、リスト表示用の list、単体表示用の single、それらの中で表示する1要素を表すための itemの4つを作成する。
baseof.json.json item.json.json single.json.json list.json.json layouts/_default/baseof.json.json { "data" : {{ block "response" .}}{{ end }} } このブログのJSONレスポンスは全てdata プロパティとして response ブロックをレンダリングして返す。 各 pageKindでは responseを定義する。
layouts/_default/item.json.json { "title": "{{ .Title }}", "date": "{{ .<div class=read-more-link><a href=/posts/hugo-as-json-api/>Read More…</a></div></article><article class=post><h1 class=post-title><a href=/posts/first-post/>First Post</a></h1><time datetime=2020-01-01T18:44:41+0900 class=post-date>Wed, Jan 1, 2020</time>
ブログを放置しっぱなしだったので作り直してみる。
とりあえず手っ取り早くできる hugo + Github Page で作り直した。</article></div></main></body></html>
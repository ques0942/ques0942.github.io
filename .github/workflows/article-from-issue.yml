name: pullrequest from issue

on:
  issues:
    types: [opened, edited, labeled, unlabeled]

env:
  ISSUE_ID: ${{ github.event.issue.id }}
  ISSUE_TITLE: ${{ github.event.issue.title }}
  ISSUE_BODY: ${{ github.event.issue.body }}
  BRANCH: from_issue-${{ github.event.issue.id }}
  MD_PATH: content/posts/${{ github.event.issue.id }}.md

jobs:
  create_article:
    runs-on: ubuntu-18.04
    if: |
      (github.event.action == 'opend'
      || github.event.action == 'edited'
      || github.event.action == 'labeled')
      && contains(github.event.issue.labels.*.name, 'article')
    steps:
      - uses: actions/checkout@v2
        with:
          ref: source
          submodules: true
      #- name: create branch
      #  run: |
      #    git checkout -b ${BRANCH}
      - name: dump issue
        run: |
          echo -e "${ISSUE_BODY}" > ${MD_PATH}
          #git config --global user.email "nari0942@gmail.com"
          #git config --global user.name "ques0942"
          #git add ${MD_PATH}
          #git commit -m "add post from issue #${ISSUE_ID}"
      - name: Create pull request
        uses: peter-evans/create-pull-request@v2
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ env.BRANCH }}
          base: "source"
          commit-message: "add post from issue #${ISSUE_ID}"
          title: "add post from issue '${ISSUE_TITLE}'"
          force: true
